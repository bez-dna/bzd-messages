syntax = "proto3";
package bzd.messages.messages;

import "google/protobuf/timestamp.proto";

service MessagesService {
    rpc CreateMessage(CreateMessageRequest) returns (CreateMessageResponse);
    rpc GetUserMessages(GetUserMessagesRequest)
        returns (GetUserMessagesResponse);
    rpc GetMessages(GetMessagesRequest) returns (GetMessagesResponse);
    rpc GetMessage(GetMessageRequest) returns (GetMessageResponse);
    rpc GetMessageMessages(GetMessageMessagesRequest)
        returns (GetMessageMessagesResponse);
}

message CreateMessageRequest {
    optional string current_user_id = 100;
    optional string text = 101;
    optional string xxx = 102;
    optional string code = 103;
    oneof tp {
        Starting starting = 104;
        Regular regular = 105;
    }

    message Starting {
        repeated string topic_ids = 101;
    }

    message Regular {
        optional string message_id = 101;
    }
}

message CreateMessageResponse {
    optional string message_id = 101;
}

message GetUserMessagesRequest {
    optional string user_id = 101;
    optional string cursor_message_id = 102;
}

message GetUserMessagesResponse {
    repeated string message_ids = 101;
    optional string cursor_message_id = 102;
}

message GetMessagesRequest {
    repeated string message_ids = 101;
}

message GetMessagesResponse {
    repeated Message messages = 501;

    message Message {
        optional string message_id = 101;
        optional string text = 102;
        optional string user_id = 103;
        optional string code = 104;

        optional google.protobuf.Timestamp created_at = 901;
        optional google.protobuf.Timestamp updated_at = 902;
    }
}

message GetMessageRequest {
    optional string message_id = 101;
}

message GetMessageResponse {
    optional Message message = 501;

    message Message {
        optional string message_id = 101;
        optional string text = 102;
        optional string user_id = 103;
        optional string code = 104;

        optional google.protobuf.Timestamp created_at = 901;
        optional google.protobuf.Timestamp updated_at = 902;
    }
}

message GetMessageMessagesRequest {
    optional string message_id = 101;
    optional string cursor_message_id = 102;
}

message GetMessageMessagesResponse {
    repeated string message_ids = 101;
    optional string cursor_message_id = 102;
}
